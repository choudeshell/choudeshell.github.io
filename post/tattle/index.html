<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Tattle - Yet Another Entity Framework Event Exposer &middot; Chris Houdeshell</title>
        <meta name="description" content="">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.15" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="http://choudeshell.com/css/normalize.css">
        <link rel="stylesheet" href="http://choudeshell.com/css/highlight.css">
        <link rel="stylesheet" href="http://choudeshell.com/css/style.css">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/idea.min.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    </head>
    <body>
        

        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="Tattle - Yet Another Entity Framework Event Exposer" href="http://choudeshell.com/">Tattle - Yet Another Entity Framework Event Exposer</a>
                            </h1>
                        
                        <a class="button-square" href="http://choudeshell.com/index.xml"><i class="fa fa-rss"></i></a>
                        
                            <a class="button-square button-social hint--top" data-hint="Twitter" title="Twitter" href="https://twitter.com/choudeshell">
                                <i class="fa fa-twitter"></i>
                            </a>
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/choudeshell">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="LinkedIn" title="LinkedIn" href="http://www.linkedin.com/in/choudeshell">
                                <i class="fa fa-linkedin"></i>
                            </a>
                        
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="Blog" href="http://choudeshell.com/">Blog</a>
    </li>

    <li class="site-nav-item">
        <a title="About" href="http://choudeshell.com/about/">About</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">

<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Tattle - Yet Another Entity Framework Event Exposer</h1>
    
    <p class="post-date">
        <span>Published <time datetime="2014-05-03" itemprop="datePublished">Sat, May 3, 2014</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="http://schema.org/Person">
            <span itemprop="name">
                <a href="" itemprop="url" rel="author">Chris Houdeshell</a>
            </span>
        </span>
    </p>
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <p>Debugging Entity Framework generated SQL is tough at times. The sometimes-elegant SQL is filled with parameters in every facet. One of the ways to view that SQL is to call .ToString() on any IQueryable. If you want to print the SQL out to the debug console in Visual Studio or even log the SQL &ndash; you&rsquo;ll have to create a wrapped provider.</p>

<p><a href="http://code.msdn.microsoft.com/EFProviderWrappers-c0b88f32">Microsoft provides a logging and cache provider</a> example. Based off the idea of this example, I created a wrapped provider of my own that should simplify tracing and logging of the generate SQL.</p>

<p><a href="https://github.com/choudeshell/tattle">Tattle</a> provides and easy to use abstraction. It is as simple as implementing an ITattler and a few methods. The methods and a description of the &lsquo;events&rsquo; are:
<ul>
    <li>CommandResult - Fire when a command is completed</li>
    <li>DbConnectionClose - Fired when a connection is closed</li>
    <li>DbConnectionStart - Fired when a connection is opened</li>
    <li>DtcTransactionComplete - Fired when a Distrubted Transaction Coordinator transactions is completed (committed)</li>
    <li>DtcTransactionEnlist - Fired when a DTC transaction is created</li>
    <li>StatementException - Fired when a DbCommand throws an exception</li>
    <li>StatementExecute - Fired after a DbCommand is executed</li>
    <li>StatementRowCount - Fired after a DbCommand is executed</li>
    <li>TransactionBegin - When a generic/SQL transaction is started</li>
    <li>TransactionComplete - Fired when a transaction is committed</li>
    <li>TransactionDispose - Fired when a transaction is GC</li>
    <li>TransactionRollback - Fired when a transaction is rolled back</li>
</ul>
A full implementation of an ITattler:</p>

<pre><code>public class TraceTattler:ITattler
{
    /// &amp;lt;summary&amp;gt;
    /// Default constructor
    /// &amp;lt;/summary&amp;gt;
    public TraceTattler()
    {

    }

    /// &amp;lt;summary&amp;gt;
    /// Prints the command results
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&quot;milliseconds&quot;&amp;gt;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&quot;rowCount&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void CommandResult(Guid connectionId, long milliseconds, int? rowCount)
    {
        var output = String.Format(&quot;Connection: {0}tDuration: {1}tRowCount: {2}&quot;, connectionId, milliseconds, rowCount);
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when the connection is 'close' (put back in the pool)
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void DbConnectionClose(Guid connectionId)
    {
         var output = String.Format(&quot;Connection Closed: {0}t&quot;, connectionId);
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when the connection is opened
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void DbConnectionStart(Guid connectionId)
    {
        var output = String.Format(&quot;Connection Started: {0}t&quot;, connectionId);
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when a distributed transaction is complete
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&quot;status&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void DtcTransactionComplete(Guid connectionId, System.Transactions.TransactionStatus status)
    {
        var output = String.Format(&quot;DTC Transaction Begin: {0}tStatus: {1}&quot;, connectionId, status.ToString());
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when a distributed transaction is created
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&quot;isolationLevel&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void DtcTransactionEnlist(Guid connectionId, System.Transactions.IsolationLevel isolationLevel)
    {
        var output = String.Format(&quot;DTC Transaction Enlisted: {0}tStatus: {1}&quot;, connectionId, isolationLevel.ToString());
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when the provider implimentor triggers an exception (ie bad sql)
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&quot;exception&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void StatementException(Guid connectionId, Exception exception)
    {
        var output = String.Format(&quot;Statement Exception: {0}tConnection: {1}&quot;, exception.ToString(), connectionId);
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when a statement is executed
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&quot;statementId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&quot;dbCommand&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void StatementExecute(Guid connectionId, Guid statementId, System.Data.Common.DbCommand dbCommand)
    {
        var output = String.Format(&quot;Connection: {0}tID: {1}tStatement: {2}{3}&quot;, connectionId, statementId,Environment.NewLine,((SqlCommand) dbCommand).ToSqlString());
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when a statement is executed returning the effected record count
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&quot;statementId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&quot;rowCount&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void StatementRowCount(Guid connectionId, Guid statementId, int rowCount)
    {
         var output = String.Format(&quot;Statement Row Count: {0}tConnection: {1}tID: {2}&quot;, rowCount, connectionId, statementId);
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when a transaction is opened
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    /// &amp;lt;param name=&quot;isolationLevel&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void TransactionBegin(Guid connectionId, System.Data.IsolationLevel isolationLevel)
    {            
        var output = String.Format(&quot;Transaction Begin: {0}tIsolationLevel: {1}&quot;, connectionId, isolationLevel);
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when a transaction is commited
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void TransactionCommit(Guid connectionId)
    {
        var output = String.Format(&quot;Transaction Commit: {0}&quot;, connectionId);
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when a transaction is closed
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void TransactionDispose(Guid connectionId)
    {
        var output = String.Format(&quot;Transaction Dispsoe: {0}&quot;, connectionId);
        Debug.WriteLine(output);
    }

    /// &amp;lt;summary&amp;gt;
    /// Fired when a transaction is rolled back
    /// &amp;lt;/summary&amp;gt;
    /// &amp;lt;param name=&quot;connectionId&quot;&amp;gt;&amp;lt;/param&amp;gt;
    public void TransactionRollBack(Guid connectionId)
    {
        var output = String.Format(&quot;Transaction Rollback: {0}&quot;, connectionId);
        Debug.WriteLine(output);
    }
}
</code></pre>

<p><h3> Entity Framework 6</h3>
At the moment, Tattle doesn&rsquo;t work with EF6. One of the reason is that Tattle is a custom provider and EF6 changed the way that it loads providers. EF6 only loads the providers once via factories for multiple DbContexts. EF5 on the other hand loaded them each time a new DbContext was constructed.
<h3>Going Forward</h3>
I&rsquo;m still working on Tattle and it has a MIT licence. The next version of Tattle will include EF6 support, a NuGet package and end to end tests. If you want to help out, head on over to <a href="https://github.com/choudeshell/tattle/issues">GitHub</a>.</p>

</div>

        <footer class="post-footer clearfix">
    

    <div class="share">
        <a class="icon-twitter" href="http://twitter.com/share?text=Tattle%20-%20Yet%20Another%20Entity%20Framework%20Event%20Exposer&url=http%3a%2f%2fchoudeshell.com%2fpost%2ftattle%2f"
            onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fa fa-twitter"></i>
            <span class="hidden">Twitter</span>
        </a>

        <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fchoudeshell.com%2fpost%2ftattle%2f"
            onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fa fa-facebook"></i>
            <span class="hidden">Facebook</span>
        </a>

        <a class="icon-google-plus" href="https://plus.google.com/share?url=http%3a%2f%2fchoudeshell.com%2fpost%2ftattle%2f"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
           <i class="fa fa-google-plus"></i>
            <span class="hidden">Google+</span>
        </a>
    </div>
</footer>

        
    </article>
</div>

</div>
</div>

<script src="http://choudeshell.com/js/jquery-1.11.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script src="http://choudeshell.com/js/jquery.fitvids.js"></script>
<script src="http://choudeshell.com/js/scripts.js"></script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41606422-1', 'auto');
  ga('send', 'pageview');

</script>
</body>

</html>
