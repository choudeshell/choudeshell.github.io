<!doctype html>
<html class="no-js">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>&#39;Namespaced&#39; claims in Keycloak &middot; Bit Herding</title>
        <meta name="author">
        <meta name="description" content="Hearding Bits">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="generator" content="Hugo 0.37" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.11.0/prism.min.js"></script>
        <link href="https://www.choudeshell.com/post/index.xml" rel="alternate" type="application/rss+xml" title="Bit Herding" />
        <link href="https://www.choudeshell.com/post/index.xml" rel="feed" type="application/rss+xml" title="Bit Herding" />
        <link href='//fonts.googleapis.com/css?family=Muli:400,300,700' rel='stylesheet' type='text/css'>
        <link href="https://fonts.googleapis.com/css?family=Fira+Mono" rel="stylesheet">
        <link rel="stylesheet" href="https://www.choudeshell.com/css/styles.css">
        <link rel="icon" href="https://www.choudeshell.com/favicon.ico">
        <link rel="apple-touch-icon" href="https://www.choudeshell.com/apple-touch-icon.png" />
        <link rel="stylesheet" href="https://www.choudeshell.com/css/highlightjs/monokai.css">
        <script src="https://www.choudeshell.com/js/vendor/modernizr-2.8.0.min.js"></script>
        
        <style>
        .site-header h2 .logo {
        background: url(https://www.choudeshell.com/img/desk.jpg) no-repeat 0 0;
        }
        @media (min--moz-device-pixel-ratio: 1.3), (-o-min-device-pixel-ratio: 2.6 / 2), (-webkit-min-device-pixel-ratio: 1.3), (min-device-pixel-ratio: 1.3), (min-resolution: 1.3dppx) {
          .site-header h2 .logo {
            background-image: url(https://www.choudeshell.com/img/desk.jpg);
        }}
       .site-header {
         background: #2a373d url(https://www.choudeshell.com/img/desk.jpg) no-repeat center center;
         z-index: -1;
        }
        </style>
    </head>
    <body>
            <div class="header-bar">
                    <div class="title">Chris<span>Houdeshell</span></div>
                    <div class="nav">
                        <ul>
                            <li><a href="https://www.choudeshell.com/">Blog</a></li>
                            <li><a href="https://www.choudeshell.com/about">About</a></li>
                            
<li><a href="//twitter.com/choudeshell" class="icon-twitter" target="_blank" title="Twitter"></a></li>





<li><a href="//linkedin.com/in/choudeshell" class="icon-linkedin" target="_blank" title="Linkedin"></a></li>









<li><a href="//github.com/choudeshell" class="icon-github" target="_blank" title="Github"></a></li>




<li><a href="https://www.choudeshell.com/blog/index.xml" class="icon-rss" target="_blank" title="RSS"></a></li>

                        </ul>
                    </div>

                </div>
        
        


<div class="container clearfix">
    <main role="main" class="content">
        <article class="post">            
            
<h1><a href="https://www.choudeshell.com/blog/keycloak-custom-claims/" title="&#39;Namespaced&#39; claims in Keycloak">&#39;Namespaced&#39; claims in Keycloak</a></h1>


<footer class="post-info">Posted on <span class="post-meta"><time datetime="2017.02.26">2017.02.26</time>
    

    &middot; Tagged in
        
        <a href="https://www.choudeshell.com/tags/keycloak">keycloak</a>
        
    

</span>

</footer>
<a href="#" class="image featured"><img src="https://www.choudeshell.com/images/keycloak.png"></a>
            <blockquote>
<p>Keycloak is an Open Source Identity and Access Management
application that rivals top IAM SaaS products, including
<a href="https://www.auth0.com">Auth0</a>.</p>
</blockquote>

<p>Something that took me an inordinate amount of time was trying
to add custom &lsquo;namespaced&rsquo; claims to the Keycloak&rsquo;s <code>access_token</code>.</p>

<p>Previously, I&rsquo;ve used Auth0 as an IAM; adding a custom claim
with <a href="https://www.auth0.com">Auth0</a> only worked with &lsquo;namespaced&rsquo; claims &mdash; claims
that was prefixed with a URL. In Auth0&rsquo;s case, <code>https://choudeshell.com/role_type</code> was considered &lsquo;namespaced&rsquo; claim.</p>

<p>Translating this functionality into Keycloak was actually
much harder than expected. Out of the box, Keycloak allows many different types of mappers for claims. Generally, all of them behave same. If a given claim name has a <code>.</code> in it, Keycloak will generate a nested object in
the resulting <code>access_token</code>.</p>

<p><code>https://choudeshell.com/role_type</code> came out to be</p>

<pre><code class="language-javascript">{
    &quot;https://choudeshell&quot;:
        {
            &quot;com/role_type&quot;:&quot;value&quot;
        }
}
`````````

What I wanted the resulting ```access_token``` to contain was:

```javascript
{
    &quot;https://choudeshell.com/role_type&quot;:&quot;value&quot;
}
</code></pre>

<p>The solution? <strong>Use a Script Mapper</strong>. A Script Mapper allows us to use plain-old Javascript. With the provided objects, we can add any claim we want and it isn&rsquo;t effected by the nesting logic.</p>

<pre><code class="language-javascript">/**
 * Available variables: 
 * user - the current user
 * realm - the current realm
 * token - the current token
 * userSession - the current userSession
 * keycloakSession - the current userSession
 */

token.setOtherClaims(&quot;https://choudeshell.com/role_type&quot;,&quot;value&quot;);
</code></pre>

<blockquote>
<p>Something to keep in mind. The Javascript Script Mapper&rsquo;s script is executed via Java &amp; Nashorn, which means the injected variables are bound both ways. You can even update the user&rsquo;s email address by calling the <code>user.setEmail('x')</code> function!</p>
</blockquote>

            <ul class="share-buttons">
    <li>Share this article:</li>
    <li>
        <a class="icon-facebook-squared" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.choudeshell.com%2fblog%2fkeycloak-custom-claims%2f" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook"></a>
    </li>
    <li>
        <a class="icon-twitter" href="https://twitter.com/share?text=%27Namespaced%27%20claims%20in%20Keycloak&amp;url=https%3a%2f%2fwww.choudeshell.com%2fblog%2fkeycloak-custom-claims%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Tweet this article"></a>
    </li>
    <li>
        <a class="icon-gplus" href="https://plus.google.com/share?url=https%3a%2f%2fwww.choudeshell.com%2fblog%2fkeycloak-custom-claims%2f" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google&#43;"></a>
    </li>
    <li>
        <a class="icon-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.choudeshell.com%2fblog%2fkeycloak-custom-claims%2f&title=%27Namespaced%27%20claims%20in%20Keycloak" onclick="window.open(this.href, 'linkedin-share', 'width=600,height=494');return false;" title="Share on Linkedin"></a>
    </li>
</ul>

            <a class="btn home" href="https://www.choudeshell.com/" title="Back to home">&laquo; Back to home</a>
        </article>
        
    </main>
 
</div>



<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>window.jQuery || document.write('<script src="https:\/\/www.choudeshell.com\/js\/vendor\/jquery-1.11.0.min.js"><\/script>')</script>
<script src="https://www.choudeshell.com/js/plugins.js"></script>




<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-41606422-1', 'auto');
ga('send', 'pageview');
</script>

</body>
</html>

